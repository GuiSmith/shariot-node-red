[
    {
        "id": "parse_payload",
        "type": "function",
        "z": "d825e256770b54a7",
        "name": "Processa presença",
        "func": "let presenca = msg.payload.presenca;\n\n// Converte para boolean (1 -> true, 0 ou outro -> false)\nlet presencaBool = (presenca == 1);\n\n// Recupera último valor do contexto (persistente no nó)\nlet ultimoValor = context.get('ultimoPresenca') || false;\n\nnode.warn(presencaBool === ultimoValor);\nnode.warn(presenca);\n\n// Se o valor não mudou, não envia nada (retorna null para bloquear)\nif (presencaBool === ultimoValor) {\n  return null;\n}\n\nnode.warn(`Mudança de presença: ${presencaBool}`);\n\n// Atualiza o contexto com o valor novo\ncontext.set('ultimoPresenca', presencaBool);\n\n// Envia a mensagem com o payload formatado em JSON\nmsg.payload = JSON.stringify({\n  presenca: presencaBool\n});\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 280,
        "wires": [
            [
                "98efc15330fd5707"
            ]
        ]
    }
]
